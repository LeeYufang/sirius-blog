<?xml version='1.0' encoding='utf-8' ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/></head><body><h1 id="FixitSirius">Fix it Sirius!</h1><p>This week the <a href="http://www.eclipse.org/sirius/">Sirius</a> blog <a href="http://melb.enix.org/category/sirius/">post series</a> presents &#171;how to integrate validation rules on a diagram ?&#187;.</p><p>EMF provides a powerful validation system which helps you to detect errors in your model. But sometimes you would like to add some more rules not already implemented in your metamodel. Sirius is there again!</p><p>Imagine that we would like to represent the well known Arcade game from the <a href="http://en.wikipedia.org/w/index.php?title=Wreck-It_Ralph">Wreck it Ralph!</a> movie. <br/><img border="0" src="./images/Wreckitralphposter.jpeg"/></p><p>We define a metamodel which allows us to represent the <code>Building</code> present in the game.<br/><img border="0" src="./images/metamodel.png"/></p><p>We define also an attribute <code>isFixed</code> to know if the building is broken and so if it needs to be fixed.</p><h2 id="Semanticvalidation">Semantic validation</h2><p>Then we create a new Sirius specification project and we define a viewpoint with a new diagram named <code>SemanticValidation</code>. A <code>Building</code> mapping is added and provides two different styles according if the building is broken or not.<br/><img border="0" src="./images/semanticvalidation_vsm.png"/></p><p>We create a model example defining a <code>Game</code> element and a <code>Building</code>, we activate our new viewpoint and create a new <em>SemanticValidation</em> diagram.<br/><img border="0" src="./images/semanticvalidation.png"/> </p><p>We create also a <em>Wreck it</em> tool which can be applied on a Building and set the <code>isFixed</code> attribute to <code>false</code>. After applying the tool on the building the diagram looks as below:<br/><img border="0" src="./images/semanticvalidation_wreck.png"/>  </p><p>Next a rule is defined to detect when the <code>isFixed</code> attribute is set to <code>false</code>. We improve our diagram specification by adding a new <a href="http://www.eclipse.org/sirius/doc/specifier/diagrams/Diagrams.html#validation">Validation rule</a>. To do so on the diagram specification element, select <code>New Validation &gt; Validation</code> and create a <code>Semantic Validation Rule</code>.<br/><img border="0" src="./images/semanticvalidationrule_vsm.png"/></p><p>Then, we set :</p><ul><li>the <code>Level</code>: severity of issues thrown when the validation rule is broken. It could be <code>Information</code>, <code>Warning</code> or <code>Error</code>.</li><li>the <code>target class</code>: kind of semantic element checked by the rule.</li><li>the <code>Message</code>: that will be shown to the user in the <em>Problems</em> view when the validation failed.</li></ul><p>An <code>Audit</code> element must be also defined to provide the expression that must be checked to validate the rule. While the expression returns true, there is no validation issue else issues will be listed in the <em>Problems</em> view. It is possible to define several audits for one rule, in this case the rule is considered as violated if at least one audit applies.<br/><img border="0" src="./images/audit.png"/></p><p>The user can call the validation thanks to a right click on the diagram background and by selecting the <em>Validate diagram</em> menu:<br/><img border="0" src="./images/validate_diagram.png"/></p><p>If we activate the validation on our wrecked building, we got one error:<br/><img border="0" src="./images/semanticvalidation_error.png"/></p><p>On the diagram, the validation issue is also visible thanks to an error decorator added on the figure:<br/><img border="0" src="./images/error_decorator.png"/></p><h2 id="Viewvalidation">View validation</h2><p>Another possibility is to define validation rules based on graphical elements instead of the semantic ones.<br/>We create another representation named <em>ViewValidation</em> which provides a view validation rule:<br/><img border="0" src="./images/viewvalidationrule_vsm.png"/></p><p>In this case, the validation rule will be applied on a mapping. </p><p>This time an error will be thrown when the border color RGB red component of the building will be different than 239.<br/>We define also a quick fix which also modified the semantic model to fix the building again.</p><h2 id="Quickfix">Quick fix</h2><p>People using Eclipse loves their IDE because it proposes powerful <em>Quick fix</em>. Sirius allows us to provide really easily a "Felix <em>quick fix</em> it":<br/><img border="0" src="./images/Fix-It-Felix.jpg"/> </p><p>On the validation rule element, we define the <code>Fix</code>.<br/><img border="0" src="./images/fix_vsm.png"/></p><p>We set the fix message and define how the fix will update the model. Finally if we launch the quick fix on our example, it just changes the value of the <code>isFixed</code> attribute to <code>true</code>. <br/><img border="0" src="./images/quickfix1.png"/><br/><img border="0" src="./images/quickfix2.png"/></p><p>Thanks to Sirius and Felix our building is all fixed. <br/><img border="0" src="./images/semanticvalidation.png"/> </p><p>You can wreck it again... thanks Ralph...</p><p>The sample code from this example is available on github: <a href="https://github.com/mbats/sirius-blog/tree/master/validation">https://github.com/mbats/sirius-blog/tree/master/validation</a></p></body></html>